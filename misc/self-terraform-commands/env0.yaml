version: 2
deploy:
  steps:
    terraformApply:
      after:
        - name: cat ~/.terraformrc
          run: | 
            cat ~/.terraformrc
            cat "credentials "backend-pr10424.api.dev.env0.com" {" > ~/.terraformrc
            cat '  token = "MGRvcjMxeGtzeW5scGJxazpaOXA2RlFhUWFraHhablpBVGgyZU9heEtvenNZZ2pNSQ=="' >> ~/.terraformrc
            cat "}" >> ~/.terraformrc
            cat ~/.terraformrc

        - name: TF_FORCE_LOCAL_BACKEND is...
          run: echo TF_FORCE_LOCAL_BACKEND=$TF_FORCE_LOCAL_BACKEND        
        - name: local-cli terraform init
          run: TF_FORCE_LOCAL_BACKEND=$TF_FORCE_LOCAL_BACKEND terraform -chdir='./loacl-tf-run' init
        - name: local-cli terraform 
          run: TF_FORCE_LOCAL_BACKEND=$TF_FORCE_LOCAL_BACKEND terraform -chdir='./loacl-tf-run' plan
        - name: local-cli terraform apply
          run: TF_FORCE_LOCAL_BACKEND=$TF_FORCE_LOCAL_BACKEND terraform -chdir='./loacl-tf-run' apply -auto-approve
      