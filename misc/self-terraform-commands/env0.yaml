version: 2
deploy:
  steps:
    terraformApply:
      after:
        - name: use ApiKey for login to env0 Remote Backend
          run: | 
            cat ~/.terraformrc
            echo 'credentials "backend-pr10424.api.dev.env0.com" {' > ~/.terraformrc
            echo '  token = "MGRvcjMxeGtzeW5scGJxazpaOXA2RlFhUWFraHhablpBVGgyZU9heEtvenNZZ2pNSQ=="' >> ~/.terraformrc
            echo '}' >> ~/.terraformrc
            cat ~/.terraformrc

        - name: TF_FORCE_LOCAL_BACKEND is...
          run: echo TF_FORCE_LOCAL_BACKEND=$TF_FORCE_LOCAL_BACKEND

        - name: terraform init (as Local CLI User)
          run: terraform -chdir='./loacl-tf-run' init

        - name: terraform plan (as Local CLI User)
          run: terraform -chdir='./loacl-tf-run' plan

        - name: terraform apply (as Local CLI User)
          run: terraform -chdir='./loacl-tf-run' apply -auto-approve
      